---
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

// Read the product filters data at build time
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const filtersPath = path.resolve(__dirname, '../../public/data/product-filters.json');

let brands: string[] = [];
try {
  const filtersData = JSON.parse(fs.readFileSync(filtersPath, 'utf-8'));
  brands = filtersData.brands || [];
} catch (error) {
  console.error('Error loading product filters:', error);
}
---

<div class="filters">
    <fieldset class="filter-wrapper filter-bar-info">
        <div class="filter-bar-info-message">As an Amazon Associate I earn from qualifying purchases.</div>
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">Condition</legend>
        <label for="filter-condition-new" class="filter-label">
        <input type="checkbox" class="filter-checkbox" id="filter-condition-new" checked="checked" />New</label>
        <label for="filter-condition-used" class="filter-label">
        <input type="checkbox" class="filter-checkbox" id="filter-condition-used" checked="checked" />Used</label>
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">Capacity (GB)</legend>
        <label for="filter-capacity-min">
        <input type="number" class="numeric-input" id="filter-capacity-min" min="0" />Min</label>
        <label for="filter-capacity-max">
        <input type="number" class="numeric-input" id="filter-capacity-max" min="0" />Max</label>
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">Technology</legend>
        <label for="filter-technology-ddr" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-technology-ddr" checked="checked" />DDR</label>
        <label for="filter-technology-ddr2" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-technology-ddr2" checked="checked" />DDR2</label>
        <label for="filter-technology-ddr3" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-technology-ddr3" checked="checked" />DDR3</label>
        <label for="filter-technology-ddr3l" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-technology-ddr3l" checked="checked" />DDR3L</label>
        <label for="filter-technology-ddr4" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-technology-ddr4" checked="checked" />DDR4</label>
        <label for="filter-technology-ddr5" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-technology-ddr5" checked="checked" />DDR5</label>
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">Price</legend>
        <label for="filter-price-min">
            <input type="number" class="numeric-input" id="filter-price-min" min="0" />Min</label>
        <label for="filter-price-max">
            <input type="number" class="numeric-input" id="filter-price-max" min="0" />Max</label>
    </fieldset>

    <fieldset class="filter-wrapper brands-filter">
        <legend class="filter-legend">Brands <input type="checkbox" class="filter-checkbox select-all" id="filter-brand-all" checked="checked" data-group="brand" /></legend>
        {brands.map((brand: string) => {
            const brandId = brand.toLowerCase().replace(/[^a-z0-9]/g, '-');
            return (
                <label for={`filter-brand-${brandId}`} class="filter-label">
                    <input 
                        type="checkbox" 
                        class="filter-checkbox" 
                        id={`filter-brand-${brandId}`} 
                        data-original-brand={brand}
                        checked="checked" 
                    />{brand}
                </label>
            );
        })}
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">Compatibility</legend>
        <label for="filter-compatibility-desktop" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-compatibility-desktop" checked="checked" />Desktop</label>
        <label for="filter-compatibility-laptop" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-compatibility-laptop" checked="checked" />Laptop</label>
        <label for="filter-compatibility-server" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-compatibility-server" checked="checked" />Server</label>
        <label for="filter-compatibility-rackserver" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-compatibility-rackserver" checked="checked" />Rack Server</label>
        <label for="filter-compatibility-workstation" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-compatibility-workstation" checked="checked" />Workstation</label>
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">CAS Latency <input type="checkbox" class="filter-checkbox select-all" id="filter-latency-all" checked="checked" data-group="latency" /></legend>
        <label for="filter-latency-cl11" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl11" checked="checked" />CL11</label>
        <label for="filter-latency-cl13" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl13" checked="checked" />CL13</label>
        <label for="filter-latency-cl16" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl16" checked="checked" />CL16</label>
        <label for="filter-latency-cl17" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl17" checked="checked" />CL17</label>
        <label for="filter-latency-cl18" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl18" checked="checked" />CL18</label>
        <label for="filter-latency-cl22" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl22" checked="checked" />CL22</label>
        <label for="filter-latency-cl28" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl28" checked="checked" />CL28</label>
        <label for="filter-latency-cl30" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl30" checked="checked" />CL30</label>
        <label for="filter-latency-cl32" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl32" checked="checked" />CL32</label>
        <label for="filter-latency-cl34" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl34" checked="checked" />CL34</label>
        <label for="filter-latency-cl36" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl36" checked="checked" />CL36</label>
        <label for="filter-latency-cl38" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl38" checked="checked" />CL38</label>
        <label for="filter-latency-cl40" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-latency-cl40" checked="checked" />CL40</label>
    </fieldset>

    <fieldset class="filter-wrapper">
        <legend class="filter-legend">Form Factor</legend>
        <label for="filter-type-dimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-dimm" checked="checked" />DIMM</label>
        <label for="filter-type-fb-dimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-fb-dimm" checked="checked" />FB-DIMM</label>
        <label for="filter-type-lr-dimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-lr-dimm" checked="checked" />LR-DIMM</label>
        <label for="filter-type-microdimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-microdimm" checked="checked" />MicroDIMM</label>
        <label for="filter-type-rdimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-rdimm" checked="checked" />RDIMM</label>
        <label for="filter-type-so-dimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-so-dimm" checked="checked" />SO-DIMM</label>
        <label for="filter-type-udimm" class="filter-label">
            <input type="checkbox" class="filter-checkbox" id="filter-type-udimm" checked="checked" />UDIMM</label>
    </fieldset>

    <fieldset class="filter-wrapper filter-bar-info">
        <div class="filter-bar-privacy-message"><a href="/privacy-policy" target="_blank">Privacy Policy</a></div>
    </fieldset>

    <fieldset class="filter-wrapper filter-bar-info">
        <div class="filter-bar-blog-message"><a href="/blog">Blog</a></div>
    </fieldset>
</div>

<style>
    .filters {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        padding: 0 0.75rem;
        position: sticky;
        top: 1rem;
        width: 160px;
    }
    
    .filter-wrapper {
        background-color: #f1f3f5;
        border: none;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin: 0;
        padding: 0.7rem;
        transition: box-shadow 0.2s ease;
    }

    .filter-wrapper:hover {
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    }

    .brands-filter {
        max-height: 300px;
        overflow-y: auto;
    }

    .filter-bar-info {
        background-color: #e7f5ff;
        font-size: 0.85rem;
    }

    .filter-legend {
        align-items: center;
        color: #343a40;
        display: flex;
        font-weight: 600;
        gap: 0.5rem;
        padding: 0 0.5rem;
    }

    .filter-legend .filter-checkbox {
        margin: 0;
        transform: translateY(1px);
    }

    .filter-label {
        align-items: center;
        color: #495057;
        display: flex;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .filter-checkbox {
        accent-color: #4361ee;
        margin-right: 0.5rem;
    }

    .numeric-input {
        border: 1px solid #ced4da;
        border-radius: 4px;
        margin-right: 0.5rem;
        padding: 0.3rem;
        width: 60px;
    }

    @media (max-width: 768px) {
        .filters {
            position: static;
            width: 100%;
        }
    }
</style>